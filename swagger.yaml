swagger: '2.0'
info:
  version: '0.0.1'
  title: Author Haven
# during dev, should point to your local machine
host: localhost:3000
# basePath prefixes all resource paths
basePath: /
#
schemes:
  # tip: remove http to make production-grade
  - http
  - https
# format of bodies a client can send (Content-Type)
consumes:
  - application/json
# format of the responses to the client (Accepts)
produces:
  - application/json
paths:
  /:
    # binds a127 app logic to a route
    get:
      description: Returns Welcome to Author Haven
      responses:
        '200':
          description: Success
          schema:
            # a pointer to a definition
            type: object
            properties:
              Message:
                type: 'string'
                example: 'Welcome to Author Haven'
        '404':
            description: Route not found
          # responses may fall through to errors
  /api/users:
    # returns a jwt token after registration
    post:
      description: Returns a json web token after a Successfull registration
      parameters:
        - name: New user
          in: body
          required: true
          description: The User json You want to create
          schema:
            type: object
            properties:
              firtsname:
                type: 'string'
                example: 'Firtsname'
              lastname:
                type: 'string'
                example: 'Lastname'
              email:
                type: 'string'
                example: 'email@host.com'
              username:
                type: 'string'
                example: 'username'
              password:
                type: 'string'
                example: '!23Secret'
      responses:
        '201':
          description: created
          schema:
            type: object
            properties:
              user:
                type: 'object'
                properties:
                  firtsname:
                    type: 'string'
                    example: 'Firtsname'
                  lastname:
                    type: 'string'
                    example: 'Lastname'
                  email:
                    type: 'string'
                    example: 'email@host.com'
                  username:
                    type: 'string'
                    example: 'username'
                  bio:
                    type: 'string'
                    example: 'i like programming'
                  image:
                    type: 'string'
                    example: 'image1.png'

                  token:
                    type: 'string'
                    example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InVzZXJuYW0yM2hpMjMxYXNmOSIsImVtYWlsIjoibWVAZ21haWwuY29zaGEiLCJmaXJzdG5hbWUiOiJGcmllZCIsImxhc3RuYW1lIjoiTWlrZWxyaCIsImlhdCI6MTU1NTA1OTc0NX0.NfmPq_sMaD9vmdA7VH0CV2ts_6_q4eql0TiqXQVoS0w'
        '400':
          description: Bad request
        default:
          description: Unexpected Error
  /api/users/login:
    # returns a jwt token after registration
    post:
      description: Returns a json web token after a Successfull registration
      parameters:
        - name: New user
          in: body
          required: true
          description: The User json You want to create
          schema:
            type: object
            properties:
              email:
                type: 'string'
                example: 'email@host.com'
              password:
                type: 'string'
                example: '!23Secret'
      responses:
        '200':
          description: Ok
          schema:
            type: object
            properties:
              user:
                type: 'object'
                properties:
                  firtsname:
                    type: 'string'
                    example: 'Firtsname'
                  lastname:
                    type: 'string'
                    example: 'Lastname'
                  email:
                    type: 'string'
                    example: 'email@host.com'
                  username:
                    type: 'string'
                    example: 'username'
                  bio:
                    type: 'string'
                    example: 'i like programming'
                  image:
                    type: 'string'
                    example: 'image1.png'

                  token:
                    type: 'string'
                    example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InVzZXJuYW0yM2hpMjMxYXNmOSIsImVtYWlsIjoibWVAZ21haWwuY29zaGEiLCJmaXJzdG5hbWUiOiJGcmllZCIsImxhc3RuYW1lIjoiTWlrZWxyaCIsImlhdCI6MTU1NTA1OTc0NX0.NfmPq_sMaD9vmdA7VH0CV2ts_6_q4eql0TiqXQVoS0w'
        '400':
          description: Bad request
        default:
          description: Unexpected Error
  /api/auth/verify/{path}:
    # binds a127 app logic to a route
    get:
      description: Returns an object message
      produces:
        - application/json
      parameters:
        - in: path
          name: path
          description: Verification Hash
          required: true
          type: string
      responses:
        '200':
          description: Verified account successfully
          schema:
            # a pointer to a definition
            type: object
            properties:
              message:
                type: 'object'
                example: 'Account verified'
        '401':
          description: Verification token not found
  /api/auth/facebook:
    # social user login
    get:
      description: Returns user data from facebook
      responses:
        '200':
          description: success
          schema:
           type: object
           properties:
             user:
              type: object
              properties:
                username:
                 type: string
                email:
                 type: string
                bio:
                 type: string
                token:
                 type: string
                image:
                 type: string
        '404':
          description: Route not found
  /api/auth/google:
    # social user login
    get:
      description: Returns user data from google
      responses:
        '200':
          description: Success
          schema:
            # a pointer to a definition
            type: object
            properties:
              error:
                type: 'object'
                example: 'Verification token not found'
  /api/auth/twitter:
    # binds a127 app logic to a route
    get:
      description: Login with Twitter
      responses:
        '200':
          description: Redirects to twitter
  /api/auth/twitter/callback:
    # binds a127 app logic to a route
    get:
      description: Login with Twitter Callback
      responses:
        '200':
          description: Returns an object with data from twitter
  /api/auth/github:
    # binds a127 app logic to a route
    get:
      description: Login with Github
      responses:
        '200':
          description: Redirects to Github
  /api/auth/github/callback:
    # binds a127 app logic to a route
    get:
      description: Login with Github Callback
      responses:
        '200':
          description: Returns an object with data from Github
  /api/articles/{articleSlug}/rate/{rating}:
    # binds a127 app logic to a route
    post:
      description: Returns an object with user who rated, title of a rated article, and rating of an article
      produces:
        - application/json
      parameters:
        - in: path
          name: articleSlug
          description: it's a slug of an already existing article
          required: true
          type: string
        - in: path
          name: rating
          description: it's a rating of an article.
          required: true
          type: string
        - name: authorization
          in: header
          type: string
          required: true

      responses:
        '201':
          description: Article Rated
          schema:
            # a pointer to a definition
            type: object
            properties:
              status:
                type: 'integer'
              id:
                type: 'integer'
              user:
                type: object
                properties:
                  id:
                    type: 'integer'
                  username:
                    type: 'string'
              article:
                type: object
                properties:
                  title:
                    type: 'string'
                  slug:
                    type: 'string'
              rating:
                type: 'string'
        '404':
          description: Verify if a user exists
          schema:
            # a pointer to a definition
            type: object
            properties:
              status:
                type: 'integer'
              error:
                type: 'string'
        '400':
          description: Check if rating is valid
          schema:
            type: object
            properties:
              status:
                type: 'integer'
              error:
                type: 'string'
        '200':
          description: Update Rating of an article
          schema:
            # a pointer to a definition
            type: object
            properties:
              status:
                type: 'integer'
              id:
                type: 'integer'
              user:
                type: object
                properties:
                  id:
                    type: 'integer'
                  username:
                    type: 'string'
              article:
                type: object
                properties:
                  title:
                    type: 'string'
                  slug:
                    type: 'string'
              rating:
                type: 'string'
              previousRating:
                type: 'string'
        '403':
          description: Do not allow to rate an article more than once
          schema:
            type: object
            properties:
              status:
                type: 'integer'
              error:
                type: 'string'
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: Lorem Ipsum is simply dummy text
                body:
                  type: string
                  example: Lorem Ipsum is simply dummy text
                description:
                  type: string
                  example: 'Lorem Ipsum is simply dummy text of the printing   and typesetting industry. Lorem Ipsum has been the industry'
                tagList:
                  items:
                    type: string
                    example: Sport
      responses:
        201:
          description: article updated
          content:
              application/json:
                schema:
                  type: object
                  properties:
                    article:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        title:
                          type: string
                          example: Lorem Ipsum is simply dummy text
                        slug:
                          type: string
                          example: world-class-devs-77f5d72
                        body:
                          type: string
                          example: Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.
                        createdAt:
                          type: string
                          example: "2019-04-29 15:36:48.352+02"
                        updatedAt:
                          type: string
                          example: "2019-04-29 15:36:48.352+02"
  /api/articles/all:
    get:
      tags:
        - Articles
      description: get all article
      responses:
        200:
          description: list of articles
          content:
              application/json:
                schema:
                  type: object
                  properties:
                    article:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        title:
                          type: string
                          example: Lorem Ipsum is simply dummy text
                        slug:
                          type: string
                          example: world-class-devs-77f5d72
                        body:
                          type: string
                          example: Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.
                        createdAt:
                          type: string
                          example: "2019-04-29 15:36:48.352+02"
                        updatedAt:
                          type: string
                          example: "2019-04-29 15:36:48.352+02"
        404:
          description: No article found with the specified slug
  /api/auth/profile:
    # edit user profile
    post:
      description: Edit user profile
      parameters:
      - name: New user
        in: body
        description: The User json You want to create
        schema:
          type: object
          properties:
            firtsname:
              type: 'String'
              example: 'Firtsname'
            lastname:
              type: 'String'
              example: 'Lastname'
            email:
              type: 'String'
              example: 'email@host.com'
            username:
              type: 'String'
              example: 'username'
            password:
              type: 'String'
              example: '!23Secret'
      responses:
        '201':
          description: created
          schema:
            type: 'object'
            properties:
              firtsname:
                type: 'String'
                example: 'Firtsname'
              lastname:
                type: 'String'
                example: 'Lastname'
              email:
                type: 'String'
                example: 'email@host.com'
              username:
                type: 'String'
                example: 'username'
              bio:
                type: 'String'
                example: 'i like programming'
              image:
                type: 'String'
                example: 'image1.png'

  /api/articles/{articleSlug}/rates:
    get:
      description: Returns an object with title, slug of an article, and names of users who rated it.
      produces:
        - application/json
      parameters:
        - in: path
          name: articleSlug
          description: it's slug of an existing article
          required: true
          type: string
        - in: header
          name: authorization
          type: string
          required: true

      responses:
        '400':
          description: slug of an article can not be a number
          schema:
            type: object
            properties:
              status:
                type: 'integer'
              error:
                type: 'string'
        '404':
          description: Article can not be found
          schema:
            type: object
            properties:
              status:
                type: 'integer'
              error:
                type: 'string'
        '200':
          description: fetch rating of an article
          schema:
            type: object
            properties:
              status:
                type: 'integer'
              article:
                type: object
                properties:
                  title:
                    type: 'string'
                  slug:
                    type: 'string'
              who_rated:
                type: 'array'
                items:
                  type: object
                  properties:
                    rating:
                      type: 'integer'
                    user:
                      type: object
                      properties:
                        id:
                          type: 'integer'
                        firstname:
                          type: 'string'
                        lastname:
                          type: 'string'
                        username:
                          type: 'string'
              UsersCount:
                type: 'integer'
  /api/articles/{articlelug}/comments/popular:
    # binds a127 app logic to a route
    get:
      description: Lists comments of an article sorted by popularity
      produces:
        - application/json
      parameters:
        - in: path
          name: articlelug
          description: Slug identifies an article
          required: true
          type: string
          example: how-to-cook-2dc4b2
      responses:
        '404':
          description: Article not found
          schema:
            type: object
            properties:
              message:
                type: 'Object'
                example: 'Article not found'
        '200':
          description: Listing comments by popularity
          schema:
            type: object
            properties:
              comment:
                type: 'Array'
              commentsCount:
                type: 'String'
        '401':
          description: No access token provided
          schema:
            type: object
            properties:
              error:
                type: 'String'
                example: 'No token was provided'
        '403':
          description: Provided token is invalid
          schema:
            type: object
            properties:
              error:
                type: 'String'
                example: 'The token you provided is invalid'
  /api/articles/{artslug}/comments/{id}/like:
    # binds a127 app logic to a route
    post:
      description: Like /Unlike a comment on article
      produces:
        - application/json
      parameters:
        - in: path
          name: artslug
          description: Slug identifies an article
          required: true
          type: string
          example: how-to-cook-2dc4b2
        - in: path
          name: -id
          description: Comment identifier
          required: true
          type: integer
          example: 1
      responses:
        '404':
          description: Article not found
          schema:
            type: object
            properties:
              message:
                type: 'Object'
                example: 'Article not found'
        '404':
          description: Article not found
          schema:
            type: object
            properties:
              message:
                type: 'Object'
                example: 'Article comment not found'
        '200':
          description: Comment like
          schema:
            type: object
            properties:
              message:
                type: 'Object'
                example: 'Comment liked'
        '200':
          description: Comment unlike
          schema:
            type: object
            properties:
              message:
                type: 'Object'
                example: 'Comment unliked'
        '400':
          description: No access token provided
          schema:
            type: object
            properties:
              error:
                type: 'Object'